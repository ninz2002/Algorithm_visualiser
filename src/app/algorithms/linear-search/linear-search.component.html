<div class="visualizer-container">
  
  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button class="tab-btn" 
            [class.active]="activeTab === 'overview'"
            (click)="activeTab = 'overview'">
      <span class="tab-icon"><i class="fa-solid fa-book-open"></i></span>
      Overview
    </button>
    <button class="tab-btn" 
            [class.active]="activeTab === 'visualization'"
            (click)="activeTab = 'visualization'">
      <span class="tab-icon"><i class="fa-solid fa-play"></i></span>
      Visualization
    </button>
    <button class="tab-btn" 
            [class.active]="activeTab === 'complexity'"
            (click)="activeTab = 'complexity'">
      <span class="tab-icon"><i class="fa-solid fa-chart-line"></i></span>
      Complexity
    </button>
  </div>

  <!-- TAB 1: OVERVIEW -->
  <div class="tab-content" *ngIf="activeTab === 'overview'">
    <div class="overview-container">
      <div class="overview-hero">
        <h1 class="overview-title">{{algorithmMeta?.name || "Linear Search"}}</h1>
        <p class="overview-subtitle">Search one element at a time.</p>
      </div>

      <div class="overview-content">
        <div class="overview-section">
          <div class="section-icon"><i class="fa-solid fa-magnifying-glass"></i></div>
          <h2>What is it?</h2>
          <p>"Linear Search checks each element in a list, one by one, from start to finish. It's like reading a book page by page until you find the word you're looking for."</p>
        </div>

        <div class="overview-section">
          <div class="section-icon"><i class="fa-solid fa-bullseye"></i></div>
          <h2>When to use it?</h2>
          <ul class="feature-list">
            <li><strong>Small datasets</strong> — When you have a short list to search</li>
            <li><strong>Unsorted data</strong> — Works on any order, no preparation needed</li>
            <li><strong>Simplicity matters</strong> — Easy to understand and implement</li>
          </ul>
        </div>

        <div class="key-idea-box">
          <div class="key-idea-header">
            <span class="lightbulb"><i class="fa-solid fa-lightbulb"></i></span>
            <span>Key Insight</span>
          </div>
          <p>In the worst case, you might need to check every single element. If you're searching for something at the end of a long list, that's a lot of checking!</p>
        </div>

        <div class="cta-box">
          <p>Ready to see it in action?</p>
          <button class="cta-button" (click)="activeTab = 'visualization'">
            Watch the Visualization →
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- TAB 2: VISUALIZATION -->
  <div class="tab-content" *ngIf="activeTab === 'visualization'">
    <div class="split-container">

      <!-- LEFT: Code Panel -->
      <div class="code-panel" [style.width.%]="codePanelWidth">
        <div class="panel-header">
          <div class="header-title">
            <span class="code-icon">&lt;/&gt;</span>
            <h3>Algorithm Code</h3>
          </div>
          <div class="language-badge">Python</div>
        </div>

        <div class="code-content" #codeScroller>
          <pre class="code-block"><code><span class="code-line" 
      [class.active]="isLineActive(1)" 
      [class.dim]="!isLineActive(1) && currentStep"
      #line1><span class="line-number">1</span><span class="keyword">def</span> <span class="function">linear_search</span>(arr, target):</span>
<span class="code-line" 
      [class.active]="isLineActive(2)" 
      [class.dim]="!isLineActive(2) && currentStep"
      #line2><span class="line-number">2</span>    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="function">len</span>(arr)):</span>
<span class="code-line" 
      [class.active]="isLineActive(3)" 
      [class.dim]="!isLineActive(3) && currentStep"
      #line3><span class="line-number">3</span>        <span class="keyword">if</span> arr[i] == target:</span>
<span class="code-line" 
      [class.active]="isLineActive(4)" 
      [class.dim]="!isLineActive(4) && currentStep"
      #line4><span class="line-number">4</span>            <span class="keyword">return</span> i</span>
<span class="code-line" 
      [class.active]="isLineActive(5)" 
      [class.dim]="!isLineActive(5) && currentStep"
      #line5><span class="line-number">5</span>    <span class="keyword">return</span> <span class="number">-1</span></span></code></pre>

          @if (currentStep) {
            <div class="live-explanation">
              <div class="explanation-header">
                <span class="explanation-icon"><i class="fa-solid fa-lightbulb"></i></span>
                <span class="explanation-title">What's happening?</span>
              </div>
              <p class="explanation-text">{{ getLineExplanation(currentStep.line) }}</p>
            </div>
          }

          <div class="complexity-info">
            <div class="complexity-item">
              <span class="complexity-label">Time Complexity</span>
              <span class="complexity-value">{{algorithmMeta?.time_complexity || 'O(n)'}}</span>
            </div>
            <div class="complexity-item">
              <span class="complexity-label">Space Complexity</span>
              <span class="complexity-value">{{algorithmMeta?.space_complexity || 'O(1)'}}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Resizer -->
      <div class="resizer"
           (mousedown)="onResizerMouseDown($event)"
           (touchstart)="onResizerTouchStart($event)">
        <div class="resizer-line"></div>
        <div class="resizer-handle">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <circle cx="4" cy="8" r="1.5"/>
            <circle cx="8" cy="8" r="1.5"/>
            <circle cx="12" cy="8" r="1.5"/>
          </svg>
        </div>
      </div>

      <!-- RIGHT: Visualization Panel -->
      <div class="visualization-panel" [style.width.%]="100 - codePanelWidth">

        <div class="panel-header" [class.compact]="steps.length > 0">
          <div class="header-title">
            <span class="viz-icon">▶</span>
            <h3>Live Visualization</h3>
          </div>

          @if (steps.length > 0) {
            <div class="input-controls-compact">
              <span class="input-display">Array: {{ arrayInput }}</span>
              <span class="input-display">Target: {{ target }}</span>
              <button class="edit-button" (click)="resetToEdit()"><i class="fa-duotone fa-solid fa-pen-to-square"></i> Edit</button>
            </div>
          }
        </div>

        <div class="viz-content">

          @if (currentStep) {
            <div class="animation-area">

              <div class="status-bar">
                <div class="status-left">
                  <div class="status-icon"
                       [style.color]="getActionColor(currentStep.action)">
                    {{ getActionIcon(currentStep.action) }}
                  </div>

                  <div class="status-info">
                    <div class="status-message">
                      {{ currentStep.message }}
                    </div>

                    @if (currentStep.variables.i !== undefined) {
                      <div class="status-detail">
                        Checking index
                        <span class="highlight">
                          {{ currentStep.variables.i }}
                        </span>
                      </div>
                    }
                  </div>
                </div>

                <div class="status-badge"
                     [style.background]="getActionColor(currentStep.action)">
                  {{ getActionLabel(currentStep.action) }}
                </div>
              </div>

              @if (currentStep.action === 'compare' && currentStep.variables.i !== undefined) {
                <div class="comparison-display">
                  <div class="compare-item current">
                    <span class="compare-label">Current</span>
                    <span class="compare-value">
                      {{ currentStep.data[currentStep.variables.i] }}
                    </span>
                  </div>

                  <div class="compare-operator">⟷</div>

                  <div class="compare-item target">
                    <span class="compare-label">Target</span>
                    <span class="compare-value">{{ target }}</span>
                  </div>
                </div>
              }

              <div class="array-display">
                @for (item of currentStep.data; track item; let idx = $index) {
                  <div class="array-cell-wrapper">
                    <div class="cell-index">{{ idx }}</div>

                    <div class="array-cell"
                         [class.active]="isCurrentIndex(idx)"
                         [class.found]="isFound(idx)"
                         [class.is-target]="isTarget(item)">
                      <span class="cell-value">{{ item }}</span>

                      @if (isCurrentIndex(idx)) {
                        <div class="cell-glow"></div>
                      }
                    </div>

                    @if (isCurrentIndex(idx)) {
                      <div class="pointer">
                        <div class="pointer-arrow">▼</div>
                      </div>
                    }
                  </div>
                }
              </div>

              <div class="progress-section">
                <div class="progress-label">
                  <span>Step {{ currentStepIndex + 1 }} of {{ steps.length }}</span>
                  <span>{{ progressPercentage.toFixed(0) }}%</span>
                </div>

                <div class="progress-track">
                  <div class="progress-fill"
                       [style.width.%]="progressPercentage"
                       [style.background]="getActionColor(currentStep.action)">
                  </div>
                </div>
              </div>

            </div>
          }

          @if (!currentStep) {
            <div class="input-center-state">
              <div class="input-card">
                <h3>Configure Your Search</h3>
                <p class="input-subtitle">Enter an array and target value to visualize</p>

                <div class="input-form">
                  <div class="form-group">
                    <label>Array (comma-separated)</label>
                    <input type="text"
                           [(ngModel)]="arrayInput"
                           placeholder="15, 7, 23, 9, 42, 18, 31"
                           class="input-field" />
                  </div>

                  <div class="form-group">
                    <label>Target Value</label>
                    <input type="number"
                           [(ngModel)]="target"
                           placeholder="42"
                           class="input-field" />
                  </div>

                  <button class="run-button-large" (click)="runSearch()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                      <polygon points="5 3 19 12 5 21 5 3"/>
                    </svg>
                    Run Visualization
                  </button>
                </div>
              </div>
            </div>
          }

        </div>

        @if (steps.length > 0) {
          <div class="control-panel">

            <div class="playback-controls">
              <button class="ctrl-btn" (click)="handleReset()" title="Reset">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                  <path d="M21 3v5h-5"/>
                </svg>
              </button>

              <button class="ctrl-btn"
                      (click)="handlePrevious()"
                      [disabled]="currentStepIndex === 0"
                      title="Previous">
                ◀
              </button>

              <button class="ctrl-btn play-btn"
                      (click)="handlePlayPause()"
                      title="Play/Pause">
                {{ isPlaying ? '❚❚' : '▶' }}
              </button>

              <button class="ctrl-btn"
                      (click)="handleNext()"
                      [disabled]="currentStepIndex >= steps.length - 1"
                      title="Next">
                ▶
              </button>
            </div>

            <div class="speed-control">
              <span class="speed-label">Speed</span>
              <input type="range"
                     min="200"
                     max="2000"
                     step="100"
                     [(ngModel)]="speed"
                     (input)="onSpeedChange()"
                     class="speed-slider" />
              <span class="speed-value">{{ getSpeedLabel() }}</span>
            </div>

          </div>
        }

      </div>
    </div>
  </div>

  <!-- TAB 3: COMPLEXITY -->
  <div class="tab-content" *ngIf="activeTab === 'complexity'">
    <div class="complexity-container">
      
      <div class="complexity-hero">
        <h1 class="complexity-title">Performance Analysis</h1>
        <p class="complexity-subtitle">Understanding how {{algorithmMeta?.name || 'Linear Search'}} performs</p>
      </div>

      <div class="complexity-grid">
        
        <!-- Time Complexity Card -->
        <div class="complexity-card time-card">
          <div class="card-header">
            <div class="card-icon"><i class="fa-solid fa-stopwatch"></i></div>
            <h2>Time Complexity</h2>
          </div>
          <div class="big-o">{{algorithmMeta?.time_complexity || 'O(n)'}}</div>
          <div class="card-content">
            <h3>What does this mean?</h3>
            <p>The time it takes grows <strong>linearly</strong> with the size of the array. If you double the array size, you double the search time in the worst case.</p>
            
            <h3>Why {{algorithmMeta?.time_complexity || 'O(n)'}}?</h3>
            <p>In the worst-case scenario, the target element is either:</p>
            <ul>
              <li>At the <strong>last position</strong> in the array</li>
              <li><strong>Not present</strong> at all</li>
            </ul>
            <p>In both cases, we check <em>every single element</em> — that's n comparisons for an array of size n.</p>

            <div class="example-box">
              <div class="example-title">Real-world example</div>
              <p>Imagine searching for a specific card in a deck of 52 cards by checking each card one by one. Worst case? You check all 52.</p>
            </div>
          </div>
        </div>

        <!-- Space Complexity Card -->
        <div class="complexity-card space-card">
          <div class="card-header">
            <div class="card-icon"><i class="fa-duotone fa-regular fa-floppy-disk"></i></div>
            <h2>Space Complexity</h2>
          </div>
          <div class="big-o">{{algorithmMeta?.space_complexity || 'O(1)'}}</div>
          <div class="card-content">
            <h3>What does this mean?</h3>
            <p>Linear Search uses a <strong>constant</strong> amount of extra memory, regardless of how big the input array is.</p>

            <h3>Why {{algorithmMeta?.space_complexity || 'O(1)'}}?</h3>
            <p>We only need:</p>
            <ul>
              <li>One variable to track the <strong>current index</strong></li>
              <li>No additional arrays or data structures</li>
            </ul>
            <p>Whether we're searching through 10 elements or 10 million, we use the same tiny amount of memory.</p>

            <div class="example-box">
              <div class="example-title">Real-world example</div>
              <p>Like using your finger to point at each card while searching. You don't need extra space — just your finger!</p>
            </div>
          </div>
        </div>

      </div>

      <!-- Comparison Table -->
      <div class="comparison-section">
        <h2>How does it compare?</h2>
        <table class="comparison-table">
          <thead>
            <tr>
              <th>Scenario</th>
              <th>Time Complexity</th>
              <th>When it happens</th>
            </tr>
          </thead>
          <tbody>
            <tr class="best-case">
              <td><strong>Best Case</strong></td>
              <td>{{algorithmMeta?.best_case || 'O(1)'}}</td>
              <td>Target is the first element</td>
            </tr>
            <tr class="average-case">
              <td><strong>Average Case</strong></td>
              <td>{{algorithmMeta?.average_case || 'O(n/2) → O(n)'}}</td>
              <td>Target is somewhere in the middle</td>
            </tr>
            <tr class="worst-case">
              <td><strong>Worst Case</strong></td>
              <td>{{algorithmMeta?.worst_case || 'O(n)'}}</td>
              <td>Target is last or not present</td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>

</div>